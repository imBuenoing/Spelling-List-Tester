<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <title>Spelling List Tester</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            color: #6b7280;
            font-size: 1.1em;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab:hover {
            color: #6366f1;
        }

        .tab.active {
            color: #6366f1;
            border-bottom-color: #6366f1;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }

        .word-list {
            background: #f9fafb;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .word-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #6366f1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .word-item strong {
            color: #6366f1;
            font-size: 1.1em;
        }

        .word-item p {
            margin-top: 8px;
            color: #6b7280;
            line-height: 1.6;
        }

        .countdown {
            font-size: 4em;
            text-align: center;
            color: #6366f1;
            font-weight: bold;
            margin: 40px 0;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .test-word {
            font-size: 2.5em;
            text-align: center;
            color: #1f2937;
            margin: 30px 0;
            font-weight: bold;
        }

        .test-sentence {
            font-size: 1.3em;
            text-align: center;
            color: #6b7280;
            margin: 20px 0;
            line-height: 1.8;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .saved-lists {
            margin-top: 20px;
        }

        .list-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s;
        }

        .list-card:hover {
            border-color: #6366f1;
            transform: translateX(5px);
        }

        .list-card.selected {
            border-color: #6366f1;
            background: #f0f1ff;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f4f6;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .test-controls {
            text-align: center;
            margin: 30px 0;
        }

        .file-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: #6366f1;
            background: #f9fafb;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        input[type="radio"] {
            width: auto;
            cursor: pointer;
        }

        .setup-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e5e7eb;
        }

        .setup-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.3em;
            color: #1f2937;
            margin-bottom: 15px;
            font-weight: 600;
        }

        #apiKeySection {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        #apiKeySection.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Spelling List Tester</h1>
            <p>Practice makes perfect!</p>
        </div>

        <div class="content">
            <div id="apiKeySection">
                <h3 style="margin-bottom: 15px;">üîë Setup Required</h3>
                <p style="margin-bottom: 15px;">Enter your Gemini API key to get started. Get yours at <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #6366f1;">Google AI Studio</a>.</p>
                <div class="form-group">
                    <input type="password" id="apiKeyInput" placeholder="Enter your Gemini API key">
                    <button class="btn btn-primary" onclick="saveApiKey()" style="margin-top: 10px;">Save API Key</button>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('setup')">Setup</button>
                <button class="tab" onclick="switchTab('test')">Test</button>
            </div>

            <div id="setupTab" class="tab-content active">
                <div class="setup-section">
                    <div class="section-title">Word Generation</div>
                    
                    <div class="form-group">
                        <label>Difficulty Level</label>
                        <select id="difficulty">
                            <option value="simple">Simple</option>
                            <option value="useful">Useful</option>
                            <option value="common">Common</option>
                            <option value="uncommon">Uncommon</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Generation Type</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="genType" value="random" checked>
                                Random Words
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="genType" value="related">
                                Related Words
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Tone</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="tone" value="friendly" checked>
                                Child-Friendly
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="tone" value="neutral">
                                Neutral
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Number of Words</label>
                        <select id="wordCount">
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8" selected>8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="generateWords()">
                        Generate Words
                    </button>
                </div>

                <div class="setup-section">
                    <div class="section-title">Or Enter Words Manually</div>
                    
                    <div class="form-group">
                        <label>Enter words (one per line)</label>
                        <textarea id="manualWords" placeholder="cat
dog
house
tree"></textarea>
                    </div>

                    <button class="btn btn-primary" onclick="processManualWords()">
                        Generate Sentences
                    </button>
                </div>

                <div class="setup-section">
                    <div class="section-title">Test Settings</div>
                    
                    <div class="form-group">
                        <label>Time per Word</label>
                        <select id="intervalTime">
                            <option value="10">10 seconds</option>
                            <option value="20" selected>20 seconds</option>
                            <option value="30">30 seconds</option>
                        </select>
                    </div>
                </div>

                <div id="generatedList" class="word-list" style="display:none;">
                    <h3 style="margin-bottom: 15px;">Generated Words</h3>
                    <div id="wordItems"></div>
                    <button class="btn btn-primary" onclick="saveList()">Save List</button>
                </div>

                <div class="saved-lists">
                    <h3 style="margin-bottom: 15px;">Saved Lists</h3>
                    <div id="savedListsContainer"></div>
                </div>
            </div>

            <div id="testTab" class="tab-content">
                <div id="testSetup">
                    <div class="alert alert-info">
                        Select a saved list to begin testing
                    </div>

                    <div class="form-group">
                        <label>Order</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="testOrder" value="sequential" checked>
                                Sequential
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="testOrder" value="random">
                                Random
                            </label>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="startTest()" id="startTestBtn" disabled>
                        Start Test
                    </button>
                </div>

                <div id="testRunning" style="display:none;">
                    <div class="test-word" id="currentWord"></div>
                    <div class="test-sentence" id="currentSentence"></div>
                    <div class="countdown" id="countdown"></div>
                    <div class="test-controls">
                        <button class="btn btn-danger" onclick="stopTest()">Stop Test</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let apiKey = '';
        let currentList = [];
        let selectedListId = null;
        let testWords = [];
        let currentTestIndex = 0;
        let countdownInterval = null;
        let speechSynth = window.speechSynthesis;

        // Initialize
        function init() {
            apiKey = localStorage.getItem('geminiApiKey') || '';
            if (apiKey) {
                document.getElementById('apiKeySection').classList.add('hidden');
            }
            loadSavedLists();
        }

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (!key) {
                alert('Please enter an API key');
                return;
            }
            apiKey = key;
            localStorage.setItem('geminiApiKey', key);
            document.getElementById('apiKeySection').classList.add('hidden');
            alert('API key saved successfully!');
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        async function generateWords() {
            if (!apiKey) {
                alert('Please enter your Gemini API key first');
                document.getElementById('apiKeySection').classList.remove('hidden');
                return;
            }

            const difficulty = document.getElementById('difficulty').value;
            const genType = document.querySelector('input[name="genType"]:checked').value;
            const tone = document.querySelector('input[name="tone"]:checked').value;
            const count = document.getElementById('wordCount').value;

            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = 'Generating... <span class="loading"></span>';

            try {
                const usedWords = JSON.parse(localStorage.getItem('usedWords') || '[]');
                
                const prompt = `Generate ${count} ${difficulty} difficulty spelling words for children. 
                Type: ${genType} words. 
                Tone: ${tone}.
                Avoid these previously used words: ${usedWords.join(', ')}.
                
                For each word, provide:
                1. The word (numbered)
                2. A ${tone === 'friendly' ? 'fun, child-friendly' : 'clear'} sentence using the word
                
                Format as JSON array:
                [
                    {"word": "example", "sentence": "This is an example sentence."},
                    ...
                ]`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: prompt }]
                        }]
                    })
                });

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                const jsonMatch = text.match(/\[[\s\S]*\]/);
                const words = JSON.parse(jsonMatch[0]);

                currentList = words;
                displayGeneratedWords(words);
                
                // Add to used words
                const newUsedWords = [...usedWords, ...words.map(w => w.word)];
                localStorage.setItem('usedWords', JSON.stringify(newUsedWords));

            } catch (err) {
                alert('Error generating words: ' + err.message);
                console.error(err);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Generate Words';
            }
        }

        async function processManualWords() {
            if (!apiKey) {
                alert('Please enter your Gemini API key first');
                document.getElementById('apiKeySection').classList.remove('hidden');
                return;
            }

            const manualText = document.getElementById('manualWords').value.trim();
            if (!manualText) {
                alert('Please enter some words');
                return;
            }

            const words = manualText.split('\n').filter(w => w.trim()).map(w => w.trim());
            
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = 'Generating Sentences... <span class="loading"></span>';

            try {
                const tone = document.querySelector('input[name="tone"]:checked').value;
                const prompt = `For each of these spelling words, create a ${tone === 'friendly' ? 'fun, child-friendly' : 'clear'} sentence that uses the word naturally.
                
                Words: ${words.join(', ')}
                
                Format as JSON array:
                [
                    {"word": "word1", "sentence": "Sentence using word1."},
                    ...
                ]`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: prompt }]
                        }]
                    })
                });

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                const jsonMatch = text.match(/\[[\s\S]*\]/);
                const wordList = JSON.parse(jsonMatch[0]);

                currentList = wordList;
                displayGeneratedWords(wordList);

            } catch (err) {
                alert('Error generating sentences: ' + err.message);
                console.error(err);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Generate Sentences';
            }
        }

        function displayGeneratedWords(words) {
            const container = document.getElementById('wordItems');
            container.innerHTML = words.map((item, idx) => {
                const sentence = item.sentence.replace(
                    new RegExp(`\\b${item.word}\\b`, 'gi'),
                    `<strong><u>${item.word}</u></strong>`
                );
                return `
                    <div class="word-item">
                        <strong>${idx + 1}. ${item.word}</strong>
                        <p>${sentence}</p>
                    </div>
                `;
            }).join('');
            
            document.getElementById('generatedList').style.display = 'block';
        }

        function saveList() {
            if (currentList.length === 0) return;

            const lists = JSON.parse(localStorage.getItem('spellingLists') || '[]');
            const newList = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                words: currentList,
                interval: document.getElementById('intervalTime').value
            };
            
            lists.push(newList);
            localStorage.setItem('spellingLists', JSON.stringify(lists));
            
            loadSavedLists();
            alert('List saved successfully!');
        }

        function loadSavedLists() {
            const lists = JSON.parse(localStorage.getItem('spellingLists') || '[]');
            const container = document.getElementById('savedListsContainer');
            
            if (lists.length === 0) {
                container.innerHTML = '<p style="color: #6b7280;">No saved lists yet. Create one above!</p>';
                return;
            }

            container.innerHTML = lists.map(list => `
                <div class="list-card ${selectedListId === list.id ? 'selected' : ''}" onclick="selectList(${list.id})">
                    <strong>üìÖ ${list.date}</strong> - ${list.words.length} words
                    <button class="btn btn-danger" style="float: right; padding: 5px 15px; margin: 0;" onclick="deleteList(${list.id}); event.stopPropagation();">Delete</button>
                </div>
            `).join('');
        }

        function selectList(id) {
            selectedListId = id;
            loadSavedLists();
            document.getElementById('startTestBtn').disabled = false;
        }

        function deleteList(id) {
            if (!confirm('Delete this list?')) return;
            
            let lists = JSON.parse(localStorage.getItem('spellingLists') || '[]');
            lists = lists.filter(l => l.id !== id);
            localStorage.setItem('spellingLists', JSON.stringify(lists));
            
            if (selectedListId === id) {
                selectedListId = null;
                document.getElementById('startTestBtn').disabled = true;
            }
            
            loadSavedLists();
        }

        function speak(text) {
            return new Promise(resolve => {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.onend = resolve;
                speechSynth.speak(utterance);
            });
        }

        async function startTest() {
            if (!selectedListId) return;

            const lists = JSON.parse(localStorage.getItem('spellingLists') || '[]');
            const list = lists.find(l => l.id === selectedListId);
            if (!list) return;

            const order = document.querySelector('input[name="testOrder"]:checked').value;
            testWords = [...list.words];
            
            if (order === 'random') {
                testWords.sort(() => Math.random() - 0.5);
            }

            document.getElementById('testSetup').style.display = 'none';
            document.getElementById('testRunning').style.display = 'block';

            currentTestIndex = 0;
            
            await speak(`Welcome to your spelling test. You will hear ${testWords.length} words. After each word, you will have ${list.interval} seconds to write it down. Let's begin.`);
            
            await runTest(list.interval);
        }

        async function runTest(interval) {
            for (let i = 0; i < testWords.length; i++) {
                currentTestIndex = i;
                const item = testWords[i];
                
                document.getElementById('currentWord').textContent = `Word ${i + 1}`;
                document.getElementById('currentSentence').textContent = '';
                document.getElementById('countdown').textContent = '';

                await speak(`Word ${i + 1}: ${item.word}`);
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const sentence = item.sentence.replace(item.word, '[blank]');
                document.getElementById('currentSentence').textContent = sentence;
                await speak(sentence);

                await countdown(interval);
            }

            // Review phase
            document.getElementById('currentWord').textContent = 'Review Time';
            document.getElementById('currentSentence').textContent = 'Let me repeat all the words for you...';
            document.getElementById('countdown').textContent = '';

            for (let i = 0; i < testWords.length; i++) {
                await speak(`Word ${i + 1}: ${testWords[i].word}`);
                await new Promise(resolve => setTimeout(resolve, 800));
            }

            document.getElementById('currentWord').textContent = 'Final Review';
            document.getElementById('currentSentence').textContent = 'Check your work!';
            
            await speak('Now you have 60 seconds to check your work.');
            await countdown(60);

            await speak('Time is up! Great job on your spelling test!');
            
            stopTest();
        }

        function countdown(seconds) {
            return new Promise(resolve => {
                let remaining = seconds;
                const display = document.getElementById('countdown');
                
                const update = () => {
                    display.textContent = remaining;
                    
                    if (remaining <= 10 && remaining > 0) {
                        speak(remaining.toString());
                    }
                    
                    remaining--;
                    
                    if (remaining < 0) {
                        clearInterval(countdownInterval);
                        resolve();
                    }
                };
                
                update();
                countdownInterval = setInterval(update, 1000);
            });
        }

        function stopTest() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            
            speechSynth.cancel();
            
            document.getElementById('testSetup').style.display = 'block';
            document.getElementById('testRunning').style.display = 'none';
            document.getElementById('currentWord').textContent = '';
            document.getElementById('currentSentence').textContent = '';
            document.getElementById('countdown').textContent = '';
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
